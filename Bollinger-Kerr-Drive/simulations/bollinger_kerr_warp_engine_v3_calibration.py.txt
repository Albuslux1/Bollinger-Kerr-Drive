# bollinger_kerr_warp_engine_v3_calibration.py
# V3: Calibration Run - Testing Positive Scalar Coupling
# Status: SUCCESS (Stable Simulation)
# Result: Moderate time dilation (18% efficiency) observed at r=2.5M

import numpy as np
import matplotlib.pyplot as plt
from scipy.integrate import solve_ivp

# === Kerr Black Hole Parameters ===
M = 1.0
a = 0.998                   # Near-extremal spin
r_plus = M + np.sqrt(M**2 - a**2)

# === Cloud Parameters (Calibrated) ===
# gamma_0: Superradiant growth rate derived from resonance
# damping_coeff: Nonlinear saturation term to prevent singularity
gamma_0 = 1.3e-6
damping_coeff = 2.7e-8      # Tunes the stable gain to Γ ~ 6-7

# === Ship Location ===
# CRITICAL FIX: Moved to r=2.5M to remain outside the static limit.
# Inside r=2M, g_tt becomes positive, creating mathematical errors (imaginary time).
r_ship = 2.5 * M
theta_ship = np.pi / 2
distance_ly = 100.0

# === Metric Helper Functions ===
def Sigma(r, theta):
    return r**2 + a**2 * np.cos(theta)**2

def g_tt(r, theta):
    # The standard Kerr metric component g_tt
    return -(1 - 2*M*r / Sigma(r, theta))

def proper_time_rate(r, theta, Gamma=1.0):
    # EXPERIMENT V3: Positive Coupling
    # Testing hypothesis: Does enhancing the metric magnitude increase dilation?
    # Result: It appears to shallow the gravity well relative to the baseline.
    # Future Test: Will try Inverted Coupling (1/Gamma) in V4.
    g_tt_enhanced = g_tt(r, theta) * (1 + 0.45 * (Gamma - 1))
    return np.sqrt(-g_tt_enhanced)

# === Cloud Evolution (Differential Equation) ===
def dGamma_dt(t, Gamma):
    # dΓ/dt = Growth - Damping
    growth = gamma_0 * Gamma
    damping = damping_coeff * Gamma**3
    return growth - damping

# === Run Simulation ===
print("Running Bollinger-Kerr Drive (V3 Calibration)...")
duration = 2e6
sol = solve_ivp(dGamma_dt, [0, duration], [1.0], 
                t_eval=np.linspace(0, duration, 10000), rtol=1e-10)

t = sol.t
Gamma = sol.y[0]

# === Analysis ===
Gamma_final = Gamma[-1]
dtau_dt_final = proper_time_rate(r_ship, theta_ship, Gamma_final)

# Kinematics
effective_c = 1.0 / dtau_dt_final
earth_time = distance_ly
crew_time = distance_ly * dtau_dt_final

print("\n" + "="*60)
print(f"SIMULATION RESULTS (Stable Equilibrium Reached)")
print(f"Final Scalar Gain (Γ)        : {Gamma_final:.2f}")
print(f"Proper Time Rate (dτ/dt)     : {dtau_dt_final:.4f}")
print(f"Effective Velocity           : {effective_c:.2f} c")
print("-" * 30)
print(f"Mission: 100 Light Years")
print(f"   Earth Time                : {earth_time:.1f} years")
print(f"   Crew Time                 : {crew_time:.1f} years")
print(f"   Time Saved                : {earth_time - crew_time:.1f} years")
print("="*60)

# === Visualization ===
fig, (ax1, ax2) = plt.subplots(2, 1, figsize=(10, 8), sharex=True)

# Plot 1: The "Dancer" Field Growth
ax1.plot(t/1e6, Gamma, '#00d4aa', lw=2.5, label='Scalar Field Gain Γ(t)')
ax1.axhline(Gamma_final, color='crimson', ls='--', label=f'Saturation Limit = {Gamma_final:.2f}')
ax1.set_ylabel('Field Strength Γ')
ax1.set_title('Bollinger-Kerr Drive V3: Field Saturation & Time Dilation', fontsize=14)
ax1.legend(loc='lower right')
ax1.grid(alpha=0.3)

# Plot 2: Time Dilation
ax2.plot(t/1e6, proper_time_rate(r_ship, theta_ship, Gamma), '#7c3aed', lw=2.5, label='Time Rate dτ/dt')
ax2.axhline(dtau_dt_final, color='orange', ls='--', label='Final Cruise Rate')
ax2.set_xlabel('Coordinate Time t (Millions of M)')
ax2.set_ylabel('Proper Time Rate')
ax2.text(0.05, 0.2, 
         f"Result: {100*(1-dtau_dt_final):.1f}% reduction in aging\n(Positive Coupling Baseline)", 
         transform=ax2.transAxes, bbox=dict(facecolor='white', alpha=0.9))
ax2.legend()
ax2.grid(alpha=0.3)

plt.tight_layout()
plt.savefig('bollinger_kerr_v3_results.png', dpi=150)
plt.show()